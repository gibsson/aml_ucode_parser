commit 6729b94acfd5315c5564a8689b9119591f5e47d2
Author: kunpeng.tang <kunpeng.tang@amlogic.com>
Date:   Tue Jun 18 11:33:28 2019 +0800

    Encoder: validate pgoff for VPU mmap handler [1/1]
    
    PD#OTT-3685
    
    Problem:
    unchecked pgoff for VPU mmap handler
    
    Solution:
    check pgoff for VPU mmap handler
    
    Verify:
    S922X-W200 & Android-9.0
    
    Change-Id: I9c329332b56b73a1f855af01103e3074d03211d4
    Signed-off-by: kunpeng.tang <kunpeng.tang@amlogic.com>

diff --git a/drivers/frame_sink/encoder/h265/vpu.c b/drivers/frame_sink/encoder/h265/vpu.c
index 8775930..40b47d0 100644
--- a/drivers/frame_sink/encoder/h265/vpu.c
+++ b/drivers/frame_sink/encoder/h265/vpu.c
@@ -1477,6 +1477,10 @@ static s32 vpu_map_to_physical_memory(
 				pgprot_noncached(vm->vm_page_prot);
 	}
 	/* vm->vm_page_prot = pgprot_writecombine(vm->vm_page_prot); */
+	if (!pfn_valid(vm->vm_pgoff)) {
+		enc_pr(LOG_ERROR, "%s invalid pfn\n", __FUNCTION__);
+		return -EAGAIN;
+	}
 	return remap_pfn_range(vm, vm->vm_start, vm->vm_pgoff,
 		vm->vm_end - vm->vm_start, vm->vm_page_prot) ? -EAGAIN : 0;
 }

commit a58ffb61974a29579ebb36d2f80921faddca3921
Author: Hui Zhang <hui.zhang@amlogic.com>
Date:   Wed Jul 3 10:10:53 2019 +0800

    vmh264: fixed playback not smooth issue. [1/1]
    
    PD#SWPL-7105
    
    Problem:
    this stream pts not smooth which lead playback not smooth
    
    Solution:
    when pts is 0 and slice is B frame in one field. we use
    duration to calulate a new pts
    
    Verify:
    x301
    
    Change-Id: I4a5c947c762b9a3c5cbf68298b870290200391f2
    Signed-off-by: Hui Zhang <hui.zhang@amlogic.com>

diff --git a/drivers/frame_provider/decoder/h264_multi/h264_dpb.c b/drivers/frame_provider/decoder/h264_multi/h264_dpb.c
index 845541e..a1715eb 100644
--- a/drivers/frame_provider/decoder/h264_multi/h264_dpb.c
+++ b/drivers/frame_provider/decoder/h264_multi/h264_dpb.c
@@ -1568,6 +1568,12 @@ static void dpb_combine_field(struct h264_dpb_stru *p_H264_Dpb,
 	if (fs->top_field->poc < fs->bottom_field->poc) {
 		fs->pts = fs->top_field->pts;
 		fs->pts64 = fs->top_field->pts64;
+		/*SWPL-7105 fix */
+		if ((fs->frame->slice_type == B_SLICE)
+			&& (!fs->bottom_field->pts) &&(!fs->bottom_field->pts64)) {
+			fs->pts =  0;
+			fs->pts64 = 0;
+		}
 		fs->offset_delimiter = fs->top_field->offset_delimiter;
 	} else {
 		fs->pts = fs->bottom_field->pts;

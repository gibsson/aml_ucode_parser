commit b2e59ce1b08fecf494eb19ced278e36754e74575
Author: Nanxin Qin <nanxin.qin@amlogic.com>
Date:   Tue Jun 4 17:06:46 2019 +0800

    the share sources need to be protected by lock.
    
    PD#OTT-4411
    
    Change-Id: I01bee0c10bb1263722f12893484dce819c26bc71
    Signed-off-by: Nanxin Qin <nanxin.qin@amlogic.com>

diff --git a/drivers/frame_provider/decoder/utils/vdec.c b/drivers/frame_provider/decoder/utils/vdec.c
index bb8edab..a6ccb61 100644
--- a/drivers/frame_provider/decoder/utils/vdec.c
+++ b/drivers/frame_provider/decoder/utils/vdec.c
@@ -4609,6 +4609,7 @@ static ssize_t dump_vdec_blocks_show(struct class *class,
 {
 	struct vdec_core_s *core = vdec_core;
 	char *pbuf = buf;
+	unsigned long flags = vdec_core_lock(vdec_core);
 
 	if (list_empty(&core->connected_vdec_list))
 		pbuf += sprintf(pbuf, "connected vdec list empty\n");
@@ -4619,6 +4620,7 @@ static ssize_t dump_vdec_blocks_show(struct class *class,
 				pbuf, PAGE_SIZE - (pbuf - buf));
 		}
 	}
+	vdec_core_unlock(vdec_core, flags);
 
 	return pbuf - buf;
 }
@@ -4627,6 +4629,7 @@ static ssize_t dump_vdec_chunks_show(struct class *class,
 {
 	struct vdec_core_s *core = vdec_core;
 	char *pbuf = buf;
+	unsigned long flags = vdec_core_lock(vdec_core);
 
 	if (list_empty(&core->connected_vdec_list))
 		pbuf += sprintf(pbuf, "connected vdec list empty\n");
@@ -4637,6 +4640,7 @@ static ssize_t dump_vdec_chunks_show(struct class *class,
 				pbuf, PAGE_SIZE - (pbuf - buf));
 		}
 	}
+	vdec_core_unlock(vdec_core, flags);
 
 	return pbuf - buf;
 }

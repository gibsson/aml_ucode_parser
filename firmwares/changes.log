commit 86f1c8fd9b07aa2396cbd8e4804a2d3958265184
Author: Peng Yixin <yixin.peng@amlogic.com>
Date:   Mon Jul 29 19:34:53 2019 +0800

    media_module: fixed gts h264 crash issue [1/1]
    
    PD#SWPL-9611
    
    Problem:
    gts test crash.
    Due to an internal scheduling problem with 264,
    the state is unnormal, causeing kernel crash.
    
    Solution:
    Let it not exit the decoding schedule when
    DEC_RESULT_CONFIG_PARAM logic in vh264_work.
    
    Verify:
    S805Y_P244
    
    Change-Id: I3019e88695aec9f6ca4f7e87a3bb3b67b921d672
    Signed-off-by: Peng Yixin <yixin.peng@amlogic.com>

diff --git a/drivers/frame_provider/decoder/h264_multi/vmh264.c b/drivers/frame_provider/decoder/h264_multi/vmh264.c
index 39966d2..aa065e5 100644
--- a/drivers/frame_provider/decoder/h264_multi/vmh264.c
+++ b/drivers/frame_provider/decoder/h264_multi/vmh264.c
@@ -7740,13 +7740,13 @@ static void vh264_work(struct work_struct *work)
 		u32 param3 = READ_VREG(AV_SCRATCH_6);
 		u32 param4 = READ_VREG(AV_SCRATCH_B);
 		if (vh264_set_params(hw, param1,
-			param2, param3, param4) < 0) {
-			WRITE_VREG(AV_SCRATCH_0, (hw->max_reference_size<<24) |
+			param2, param3, param4) < 0)
+			dpb_print(DECODE_ID(hw), 0, "set parameters error\n");
+		WRITE_VREG(AV_SCRATCH_0, (hw->max_reference_size<<24) |
 			(hw->dpb.mDPB.size<<16) |
 			(hw->dpb.mDPB.size<<8));
-			start_process_time(hw);
-			return;
-		}
+		start_process_time(hw);
+		return;
 	} else
 	if (((hw->dec_result == DEC_RESULT_GET_DATA) ||
 		(hw->dec_result == DEC_RESULT_GET_DATA_RETRY))

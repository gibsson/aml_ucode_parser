commit 96b88a8af905ed5b22c6a09a9365c349ffe9d0b2
Author: Hui Zhang <hui.zhang@amlogic.com>
Date:   Thu Jun 13 17:12:05 2019 +0800

    vp9: fix vp9 decoder green screen issue [1/1]
    
    PD#TV-6406
    
    Problem:
    playback youtube, the value vp9_max_pic_x is not correct with some
    APK. acutal size is beyond max value, cause canvas size overflow
    
    Solution:
    add a vp9_max_pic_x value check, to use vp9_buf_x as max when
    origanl  vp9_max_pic_x is less then vp9_buf_x
    
    Verify:
    x301
    
    Change-Id: Ie9f256ff43ddd81effb1b8b9a990d26fe09d2ee0
    Signed-off-by: Hui Zhang <hui.zhang@amlogic.com>

diff --git a/drivers/frame_provider/decoder/vp9/vvp9.c b/drivers/frame_provider/decoder/vp9/vvp9.c
index d112c65..8f67a01 100644
--- a/drivers/frame_provider/decoder/vp9/vvp9.c
+++ b/drivers/frame_provider/decoder/vp9/vvp9.c
@@ -9930,6 +9930,8 @@ static int ammvdec_vp9_probe(struct platform_device *pdev)
 	if ((debug & IGNORE_PARAM_FROM_CONFIG) == 0 &&
 			pdata->config_len) {
 #ifdef MULTI_INSTANCE_SUPPORT
+		int vp9_buf_width = 0;
+		int vp9_buf_height = 0;
 		/*use ptr config for doubel_write_mode, etc*/
 		vp9_print(pbi, 0, "pdata->config=%s\n", pdata->config);
 		if (get_config_int(pdata->config, "vp9_double_write_mode",
@@ -9943,6 +9945,14 @@ static int ammvdec_vp9_probe(struct platform_device *pdev)
 			pbi->save_buffer_mode = config_val;
 		else
 			pbi->save_buffer_mode = 0;
+		if (get_config_int(pdata->config, "vp9_buf_width",
+				&config_val) == 0) {
+			vp9_buf_width = config_val;
+		}
+		if (get_config_int(pdata->config, "vp9_buf_height",
+				&config_val) == 0) {
+			vp9_buf_height = config_val;
+		}
 
 		/*use ptr config for max_pic_w, etc*/
 		if (get_config_int(pdata->config, "vp9_max_pic_w",
@@ -9953,6 +9963,12 @@ static int ammvdec_vp9_probe(struct platform_device *pdev)
 				&config_val) == 0) {
 				pbi->max_pic_h = config_val;
 		}
+		if ((pbi->max_pic_w * pbi->max_pic_h)
+			< (vp9_buf_width * vp9_buf_height)) {
+			pbi->max_pic_w = vp9_buf_width;
+			pbi->max_pic_h = vp9_buf_height;
+			vp9_print(pbi, 0, "use buf resolution\n");
+		}
 #endif
 		if (get_config_int(pdata->config, "HDRStaticInfo",
 				&vf_dp.present_flag) == 0

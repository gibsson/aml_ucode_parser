commit 59a75fb36daa5db01bd800fe8da7e7c101768a98
Author: shihong.zheng <shihong.zheng@amlogic.com>
Date:   Thu Jan 17 19:18:41 2019 +0800

    h264_dpb: fix a gts crash problem. [1/1]
    
    PD#SWPL-4303
    
    Problem:
    gts test crash at reorder_ref_pic_list+0x16c/0x594
    
    Solution:
    add a condition to filter NULL pointer
    
    Verify:
    p215
    
    Change-Id: I1f8302f5b531be08523cf501252a81ef38a94546
    Signed-off-by: shihong.zheng <shihong.zheng@amlogic.com>

diff --git a/drivers/frame_provider/decoder/h264_multi/h264_dpb.c b/drivers/frame_provider/decoder/h264_multi/h264_dpb.c
index fc217c1..b4aefd0 100644
--- a/drivers/frame_provider/decoder/h264_multi/h264_dpb.c
+++ b/drivers/frame_provider/decoder/h264_multi/h264_dpb.c
@@ -4966,7 +4966,8 @@ static struct StorablePicture *get_long_term_pic(struct Slice *currSlice,
 	for (i = 0; i < p_Dpb->ltref_frames_in_buffer; i++) {
 		if (currSlice->structure == FRAME) {
 			if (p_Dpb->fs_ltref[i]->is_reference == 3)
-				if ((p_Dpb->fs_ltref[i]->frame->
+				if ((p_Dpb->fs_ltref[i]->frame) &&
+					(p_Dpb->fs_ltref[i]->frame->
 					is_long_term) &&
 				    (p_Dpb->fs_ltref[i]->frame->
 					long_term_pic_num ==
@@ -4974,13 +4975,16 @@ static struct StorablePicture *get_long_term_pic(struct Slice *currSlice,
 					return p_Dpb->fs_ltref[i]->frame;
 		} else {
 			if (p_Dpb->fs_ltref[i]->is_reference & 1)
-				if ((p_Dpb->fs_ltref[i]->top_field->
+				if ((p_Dpb->fs_ltref[i]->top_field) &&
+					(p_Dpb->fs_ltref[i]->top_field->
 					is_long_term) &&
 				    (p_Dpb->fs_ltref[i]->top_field->
 					long_term_pic_num == LongtermPicNum))
 					return p_Dpb->fs_ltref[i]->top_field;
+
 			if (p_Dpb->fs_ltref[i]->is_reference & 2)
-				if ((p_Dpb->fs_ltref[i]->bottom_field->
+				if ((p_Dpb->fs_ltref[i]->bottom_field) &&
+					(p_Dpb->fs_ltref[i]->bottom_field->
 					is_long_term) &&
 				    (p_Dpb->fs_ltref[i]->bottom_field->
 					long_term_pic_num ==

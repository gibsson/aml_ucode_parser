commit 7330800776b693f277829f5f085488690463d6ad
Author: Peng Yixin <yixin.peng@amlogic.com>
Date:   Thu May 30 17:32:50 2019 +0800

    module: fixed play 1080p video,seek operation lead to system crash [1/1]
    
    PD#SWPL-9190
    
    Problem:
    play 1080p video,seek operation lead to system crash
    
    Solution:
    The code incorrectly called DEC_RESULT_DONE,
    caused a problem with the decoding schedule and panic.
    
    Verify:
    verified on x301
    
    Change-Id: Ibf897891bf090cf89326083c13c06bcd31f79e30
    Signed-off-by: Peng Yixin <yixin.peng@amlogic.com>

diff --git a/drivers/frame_provider/decoder/h264_multi/vmh264.c b/drivers/frame_provider/decoder/h264_multi/vmh264.c
index ebace1a..3159647 100644
--- a/drivers/frame_provider/decoder/h264_multi/vmh264.c
+++ b/drivers/frame_provider/decoder/h264_multi/vmh264.c
@@ -5794,12 +5794,10 @@ pic_done_proc:
 			hw->got_valid_nal = 1;
 		}
 #endif
-		if (!hw->wait_for_udr_send) {
-			hw->dec_result = DEC_RESULT_DONE;
-			dpb_print(DECODE_ID(hw), PRINT_FLAG_VDEC_STATUS,
-				"%s wait_for_udr_send\n", __func__);
-			vdec_schedule_work(&hw->work);
-		}
+
+		hw->dec_result = DEC_RESULT_DONE;
+		vdec_schedule_work(&hw->work);
+
 #ifdef CONFIG_AMLOGIC_MEDIA_ENHANCEMENT_DOLBYVISION
 	} else if (
 			(dec_dpb_status == H264_FIND_NEXT_PIC_NAL) ||
@@ -7419,13 +7417,6 @@ static void user_data_ready_notify_work(struct work_struct *work)
 	vdec_wakeup_userdata_poll(hw_to_vdec(hw));
 
 	hw->wait_for_udr_send = 0;
-	if (!hw->frmbase_cont_flag) {
-		hw->dec_result = DEC_RESULT_DONE;
-		dpb_print(DECODE_ID(hw), PRINT_FLAG_VDEC_STATUS,
-			"%s\n", __func__);
-
-		vdec_schedule_work(&hw->work);
-	}
 }
 
 static int vmh264_user_data_read(struct vdec_s *vdec,

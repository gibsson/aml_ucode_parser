commit 35570cb29ce048efa9254ccb43162e338d010b69
Author: shihong.zheng <shihong.zheng@amlogic.com>
Date:   Wed Jan 23 20:06:21 2019 +0800

    mvc: fix mvc some abnormal display. [1/1]
    
    PD#SWPL-4003
    
    Problem:
    switch to other format play from mvc will flash color lump;
    
    Solution:
    keep last frame for both view0 and view1;
    
    Verify:
    x301
    
    Change-Id: Iad6ce80a8e33b67a7cd050971d5f349a4f00becf
    Signed-off-by: shihong.zheng <shihong.zheng@amlogic.com>

diff --git a/drivers/frame_provider/decoder/h264/vh264_mvc.c b/drivers/frame_provider/decoder/h264/vh264_mvc.c
index 9ad7ca2..70d26bc 100644
--- a/drivers/frame_provider/decoder/h264/vh264_mvc.c
+++ b/drivers/frame_provider/decoder/h264/vh264_mvc.c
@@ -1002,6 +1002,11 @@ static void vh264mvc_isr(void)
 						VF_BUFFER_IDX(display_buff_id));
 
 				} else if (display_view_id == 1) {
+					vf->mem_head_handle =
+					decoder_bmmu_box_get_mem_handle(
+						mm_blk_handle,
+						VF_BUFFER_IDX(display_buff_id));
+
 					vf->mem_handle =
 					decoder_bmmu_box_get_mem_handle(
 						mm_blk_handle,
@@ -1375,8 +1380,10 @@ static int vh264mvc_local_init(void)
 		vfpool_idx[i].view1_drop = 0;
 		vfpool_idx[i].used = 0;
 	}
-	for (i = 0; i < VF_POOL_SIZE; i++)
+	for (i = 0; i < VF_POOL_SIZE; i++) {
 		memset(&vfpool[i], 0, sizeof(struct vframe_s));
+		vfpool[i].index = i;
+	}
 	init_vf_buf();
 
 	if (mm_blk_handle) {
@@ -1708,13 +1715,13 @@ module_param(view_mode, uint, 0664);
 MODULE_PARM_DESC(view_mode, "\n amvdec_h264mvc view mode\n");
 
 module_param(dbg_cmd, uint, 0664);
-MODULE_PARM_DESC(dbg_mode, "\n amvdec_h264mvc cmd mode\n");
+MODULE_PARM_DESC(dbg_cmd, "\n amvdec_h264mvc cmd mode\n");
 
 module_param(drop_rate, uint, 0664);
-MODULE_PARM_DESC(dbg_mode, "\n amvdec_h264mvc drop rate\n");
+MODULE_PARM_DESC(drop_rate, "\n amvdec_h264mvc drop rate\n");
 
 module_param(drop_thread_hold, uint, 0664);
-MODULE_PARM_DESC(dbg_mode, "\n amvdec_h264mvc drop thread hold\n");
+MODULE_PARM_DESC(drop_thread_hold, "\n amvdec_h264mvc drop thread hold\n");
 module_init(amvdec_h264mvc_driver_init_module);
 module_exit(amvdec_h264mvc_driver_remove_module);
 

commit f9a90ed6f2502b574932fd3bdf0ca7bc6ec779b8
Author: Shuide Chen <shuide.chen@amlogic.com>
Date:   Fri Dec 28 13:31:40 2018 +0800

    Q-bringup: modify makefile for build and boot succeed [5/8]
    
    PD#SWPL-3168
    
    Problem:
    cannot build media modules
    
    Solution:
    fix build requirement for Qï¼Œ as:
    https://android.googlesource.com/platform/build/+/master/Changes.md
    
    Verify:
    locally and patchbuild.
    
    Change-Id: I2dda5a4804bd8ceb09fbba4a88fb0faebaa13147
    Signed-off-by: Shuide Chen <shuide.chen@amlogic.com>
    Signed-off-by: Tellen Yu <tellen.yu@amlogic.com>

diff --git a/Media.mk b/Media.mk
old mode 100644
new mode 100755
index ba112cf..7fa3c48
--- a/Media.mk
+++ b/Media.mk
@@ -60,10 +60,11 @@ $(shell cp $(MEDIA_DRIVERS)/../firmware/* $(UCODE_OUT) -rfa)
 $(shell cp $(MEDIA_DRIVERS)/* $(MEDIA_MODULES) -rfa)
 
 define media-modules
-	@$(MAKE) -C $(KDIR) M=$(MEDIA_MODULES) ARCH=$(KERNEL_ARCH) \
-	CROSS_COMPILE=$(PREFIX_CROSS_COMPILE) $(CONFIGS) \
-	EXTRA_CFLAGS+=-I$(INCLUDE) modules; \
-	find $(MEDIA_MODULES) -name "*.ko" | xargs -i cp {} $(MODS_OUT)
+	PATH=$$(cd ./$(TARGET_HOST_TOOL_PATH); pwd):$$PATH \
+		$(MAKE) -C $(KDIR) M=$(MEDIA_MODULES) ARCH=$(KERNEL_ARCH) \
+		CROSS_COMPILE=$(PREFIX_CROSS_COMPILE) $(CONFIGS) \
+		EXTRA_CFLAGS+=-I$(INCLUDE) modules; \
+		find $(MEDIA_MODULES) -name "*.ko" | PATH=$$(cd ./$(TARGET_HOST_TOOL_PATH); pwd):$$PATH xargs -i cp {} $(MODS_OUT)
 endef
 
 else
@@ -93,10 +94,12 @@ else
 TOOLS := /opt/gcc-linaro-5.3-2016.02-x86_64_aarch64-linux-gnu/bin/aarch64-linux-gnu-
 endif
 
+
 modules:
-	@$(MAKE) -C $(KDIR) M=$(MEDIA_DRIVERS) ARCH=$(KERNEL_ARCH) \
-	CROSS_COMPILE=$(TOOLS) $(CONFIGS) \
-	EXTRA_CFLAGS+=-I$(INCLUDE) -j64
+	CCACHE_NODIRECT="true" PATH=$$(cd ./$(TARGET_HOST_TOOL_PATH); pwd):$$PATH \
+		$(MAKE) -C $(KDIR) M=$(MEDIA_DRIVERS) ARCH=$(KERNEL_ARCH) \
+		CROSS_COMPILE=$(TOOLS) $(CONFIGS) \
+		EXTRA_CFLAGS+=-I$(INCLUDE) -j64
 
 copy-modules:
 	@echo "start copying media modules."
@@ -106,6 +109,7 @@ copy-modules:
 all: modules copy-modules
 
 clean:
-	$(MAKE) -C $(KDIR) M=$(MEDIA_DRIVERS) ARCH=$(KERNEL_ARCH) clean
+	PATH=$$(cd ./$(TARGET_HOST_TOOL_PATH); pwd):$$PATH \
+		$(MAKE) -C $(KDIR) M=$(MEDIA_DRIVERS) ARCH=$(KERNEL_ARCH) clean
 
 endif

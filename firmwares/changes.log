commit f84d575313d689e8bff11f5f4e0055567dd3dc14
Author: Gan Zhang <gan.zhang@amlogic.com>
Date:   Tue Oct 8 13:14:40 2019 +0800

    media_module: tiny h264 stream decode error [1/1]
    
    PD#SWPL-13083
    
    Problem:
    tiny h264 stream decode error
    
    Solution:
    disable this read cache when frame width <= 64
    IQIDCT_CONTROL, bit[16] – dcac_dma_read_cache_disable
    
    Verify:
    AC213
    
    Change-Id: I8a07b70347b335709ebe7be44735f6aa667801c6
    Signed-off-by: Gan Zhang <gan.zhang@amlogic.com>

diff --git a/drivers/frame_provider/decoder/h264_multi/vmh264.c b/drivers/frame_provider/decoder/h264_multi/vmh264.c
index 52feccc..3224145 100644
--- a/drivers/frame_provider/decoder/h264_multi/vmh264.c
+++ b/drivers/frame_provider/decoder/h264_multi/vmh264.c
@@ -3214,6 +3214,13 @@ int config_decode_buf(struct vdec_h264_hw_s *hw, struct StorablePicture *pic)
 	j = 0;
 	h264_buffer_info_data_write_count = 0;
 
+	//disable this read cache when frame width <= 64 (4MBs)
+	//IQIDCT_CONTROL, bit[16] – dcac_dma_read_cache_disable
+	if (hw->frame_width <= 64)
+		SET_VREG_MASK(IQIDCT_CONTROL,(1 << 16));
+	else
+		CLEAR_VREG_MASK(IQIDCT_CONTROL,(1 << 16));
+
 	if (last_pic)
 		dpb_print(DECODE_ID(hw), PRINT_FLAG_ERRORFLAG_DBG,
 				"last_pic->data_flag %x   slice_type %x last_pic->slice_type %x\n",

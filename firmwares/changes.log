commit e3612ddb229f330d34c050a5c23ff9201126dcbc
Author: Hui Zhang <hui.zhang@amlogic.com>
Date:   Thu May 23 19:44:25 2019 +0800

    vmh264: fix video blocked when resolution change  [1/1]
    
    PD#SWPL-7985
    
    Problem:
    when resolution changed, CONSTRAIN_MAX_BUF_NUM introduced  buf all
    used, no buf to decode. so decoding blocked
    
    Solution:
    when resolution change, allow one more buf than dpb to be used at
    that moment, which can fix decoding block issue
    
    Verify:
    AC213
    
    Change-Id: I7cda06db0b0bc60e3dff95b218dc52dbe2cc4d46
    Signed-off-by: Hui Zhang <hui.zhang@amlogic.com>

diff --git a/drivers/frame_provider/decoder/h264_multi/vmh264.c b/drivers/frame_provider/decoder/h264_multi/vmh264.c
index 58f59d5..bd867f0 100644
--- a/drivers/frame_provider/decoder/h264_multi/vmh264.c
+++ b/drivers/frame_provider/decoder/h264_multi/vmh264.c
@@ -7971,7 +7971,7 @@ static unsigned long run_ready(struct vdec_s *vdec, unsigned long mask)
 		/*avoid more buffers consumed when
 		switching resolution*/
 		if (run_ready_max_buf_num == 0xff &&
-			get_used_buf_count(hw) >=
+			get_used_buf_count(hw) >
 			hw->dpb.mDPB.size)
 			ret = 0;
 		else if (run_ready_max_buf_num &&

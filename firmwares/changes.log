commit 1bb2a1c97b0b6de8a7b063ea468e073680614ee1
Author: Nanxin Qin <nanxin.qin@amlogic.com>
Date:   Mon Aug 12 17:51:06 2019 +0800

    vmh264: avoid the used_size becoming negative. [1/1]
    
    PD#SWPL-9472
    
    Problem:
    h264 ANR issue when DTV weak signal
    
    Solution:
    avoid the used_size becoming negative.
    
    Verify:
    x301
    
    Change-Id: Ib61d1dc942faa7f60e6548f0134ecc86e3944dbc
    Signed-off-by: Nanxin Qin <nanxin.qin@amlogic.com>

diff --git a/drivers/frame_provider/decoder/h264_multi/h264_dpb.c b/drivers/frame_provider/decoder/h264_multi/h264_dpb.c
index a1715eb..2b9a920 100644
--- a/drivers/frame_provider/decoder/h264_multi/h264_dpb.c
+++ b/drivers/frame_provider/decoder/h264_multi/h264_dpb.c
@@ -2033,7 +2033,9 @@ static void remove_frame_from_dpb(struct h264_dpb_stru *p_H264_Dpb, int pos)
 	for (i = pos; i < p_Dpb->used_size - 1; i++)
 		p_Dpb->fs[i] = p_Dpb->fs[i + 1];
 	p_Dpb->fs[p_Dpb->used_size - 1] = tmp;
-	p_Dpb->used_size--;
+
+	if (p_Dpb->used_size)
+		p_Dpb->used_size--;
 }
 
 static int is_used_for_reference(struct FrameStore *fs)

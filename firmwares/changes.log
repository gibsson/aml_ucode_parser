commit d80ccb9a9b954a7f3805abc31623ef533a1125ed
Author: Cheng Tong <cheng.tong@amlogic.com>
Date:   Mon May 13 10:56:20 2019 +0800

    device: add demod avl6762 support [2/3]
    
    PD#SWPL-8315
    
    Problem:
    avl6762 can't support attach mode
    
    Solution:
    add demod avl6762 support
    
    Verify:
    verify it on franklin.
    
    Change-Id: I179ce385e4226884b510f1cda52e550a84f5dab3
    Signed-off-by: Cheng Tong <cheng.tong@amlogic.com>

diff --git a/drivers/stream_input/parser/hw_demux/aml_demod_gt.h b/drivers/stream_input/parser/hw_demux/aml_demod_gt.h
index d3541de..966e66b 100644
--- a/drivers/stream_input/parser/hw_demux/aml_demod_gt.h
+++ b/drivers/stream_input/parser/hw_demux/aml_demod_gt.h
@@ -91,4 +91,9 @@ static inline struct dvb_frontend* si2168_attach (const struct amlfe_demod_confi
 	return NULL;
 }
 
+static inline struct dvb_frontend* avl6762_attach (const struct amlfe_demod_config *config)
+{
+	return NULL;
+}
+
 #endif	/*__AML_DEMOD_GT_H__*/
diff --git a/drivers/stream_input/parser/hw_demux/aml_dvb.c b/drivers/stream_input/parser/hw_demux/aml_dvb.c
index 91bf2f7..f24ce60 100644
--- a/drivers/stream_input/parser/hw_demux/aml_dvb.c
+++ b/drivers/stream_input/parser/hw_demux/aml_dvb.c
@@ -64,6 +64,7 @@ typedef enum __demod_type
 	DEMOD_INTERNAL,
 	DEMOD_ATBM8881,
 	DEMOD_SI2168,
+	DEMOD_AVL6762,
 	DEMOD_MAX_NUM
 }demod_type;
 
@@ -2446,6 +2447,16 @@ static int aml_dvb_probe(struct platform_device *pdev)
 						s_demod_type[i] = DEMOD_SI2168;
 					}
 				}
+				if (!strcmp(name,"Avl6762")) {
+					frontend[i] = dvb_attach(avl6762_attach,&config);
+					if (frontend[i] == NULL) {
+						pr_error("dvb attach demod error\n");
+						goto error_fe;
+					} else {
+						pr_inf("dtvdemod attatch sucess\n");
+						s_demod_type[i] = DEMOD_AVL6762;
+					}
+				}
 				if (frontend[i]) {
 					ret = dvb_register_frontend(&advb->dvb_adapter, frontend[i]);
 					if (ret) {
@@ -2470,6 +2481,10 @@ error_fe:
 				dvb_detach(si2168_attach);
 				frontend[i] = NULL;
 				s_demod_type[i] = DEMOD_INVALID;
+			}else if (s_demod_type[i] == DEMOD_AVL6762) {
+				dvb_detach(avl6762_attach);
+				frontend[i] = NULL;
+				s_demod_type[i] = DEMOD_INVALID;
 			}
 			if (s_tuner_type[i] == TUNER_SI2151) {
 				dvb_detach(si2151_attach);
@@ -2527,6 +2542,8 @@ static int aml_dvb_remove(struct platform_device *pdev)
 			dvb_detach(atbm8881_attach);
 		}else if (s_demod_type[i] == DEMOD_SI2168) {
 			dvb_detach(si2168_attach);
+		}else if (s_demod_type[i] == DEMOD_AVL6762) {
+			dvb_detach(avl6762_attach);
 		}
 		if (s_tuner_type[i] == TUNER_SI2151) {
 			dvb_detach(si2151_attach);

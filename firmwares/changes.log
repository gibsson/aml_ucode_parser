commit 593fb827f63834e6b9475d25c80deac95858380f
Author: peter wang <peter.wang@amlogic.com>
Date:   Fri Mar 15 18:18:40 2019 +0800

    vmh264: fix alloc memory failed on cts accuracy test [1/1]
    
    PD#SWPL-5281
    
    Problem:
    test cts android.media.cts.DecodeAccuracyTest have failed cases
    
    Solution:
    disable mmu when using ionvideo
    
    Verify:
    verified on local
    
    Change-Id: I41a0ec051810369a69f2a7dce29fb6a913593445
    Signed-off-by: peter wang <peter.wang@amlogic.com>

diff --git a/drivers/frame_provider/decoder/h264_multi/vmh264.c b/drivers/frame_provider/decoder/h264_multi/vmh264.c
index 88c86a9..fdd0a2b 100644
--- a/drivers/frame_provider/decoder/h264_multi/vmh264.c
+++ b/drivers/frame_provider/decoder/h264_multi/vmh264.c
@@ -7732,6 +7732,14 @@ static int ammvdec_h264_probe(struct platform_device *pdev)
 			(pdata->sys_info->height * pdata->sys_info->width
 			> 1920 * 1088))
 			hw->mmu_enable = 1;
+
+	if (hw->mmu_enable &&
+		(pdata->frame_base_video_path == FRAME_BASE_PATH_IONVIDEO)) {
+		hw->mmu_enable = 0;
+		pr_info("ionvideo needs disable mmu, path= %d \n",
+				pdata->frame_base_video_path);
+	}
+
 	if (ammvdec_h264_mmu_init(hw)) {
 		h264_free_hw_stru(&pdev->dev, (void *)hw);
 		pr_info("\nammvdec_h264 mmu alloc failed!\n");
